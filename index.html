function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

async function requestOTP() {
  const phone = document.getElementById('phone').value.trim();
  if (!phone) {
    alert('กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง');
    return;
  }

  try {
    const response = await fetch('/send-otp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone })
    });
    const data = await response.json();
    document.getElementById('formMessage').style.color = data.success ? 'green' : 'red';
    document.getElementById('formMessage').innerText = data.message;
    if (data.success) {
      document.getElementById('otpSection').style.display = 'block';
    }
  } catch (error) {
    document.getElementById('formMessage').style.color = 'red';
    document.getElementById('formMessage').innerText = 'เกิดข้อผิดพลาดในการส่ง OTP';
  }
}

async function verifyOTP() {
  const phone = document.getElementById('phone').value.trim();
  const otp = document.getElementById('otp').value.trim();

  if (!otp) {
    alert('กรุณากรอกรหัส OTP');
    return;
  }

  try {
    const response = await fetch('/verify-otp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone, otp })
    });
    const data = await response.json();
    document.getElementById('formMessage').style.color = data.success ? 'green' : 'red';
    document.getElementById('formMessage').innerText = data.message;

    if (data.success) {
      // OTP ถูกต้อง, เปิดปุ่ม submit ลงทะเบียน
      document.getElementById('submitBtn').style.display = 'block';
      // ซ่อนปุ่มขอ OTP และช่องกรอก OTP
      document.querySelector('form button[type="button"]').style.display = 'none';
      document.getElementById('otpSection').style.display = 'none';
    }
  } catch (error) {
    document.getElementById('formMessage').style.color = 'red';
    document.getElementById('formMessage').innerText = 'เกิดข้อผิดพลาดในการตรวจสอบ OTP';
  }
}

function submitRegistration(event) {
  event.preventDefault();

  // เพิ่ม alert แสดง OTP จำลองที่นี่
  alert('OTP ของคุณคือ 123456 (demo)');

  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  if (!name || !phone) {
    alert('กรุณากรอกชื่อและเบอร์โทรศัพท์ให้ครบถ้วน');
    return;
  }
  // ในที่นี้สมมติแค่แสดงข้อความสำเร็จ
  document.getElementById('formMessage').style.color = 'green';
  document.getElementById('formMessage').innerText = `✅ ขอบคุณคุณ ${name}! ระบบได้รับข้อมูลของคุณแล้ว`;
  // ล้างฟอร์มหรือทำอย่างอื่นได้ตามต้องการ
  document.getElementById('registerForm').reset();
  document.getElementById('submitBtn').style.display = 'none';
  document.querySelector('form button[type="button"]').style.display = 'inline-block';
}
